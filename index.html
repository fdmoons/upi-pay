<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Secure UPI Payment</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">

<style>
body{
    margin:0;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    font-family:'Poppins',sans-serif;
    color:#fff;
}
.card{
    width:360px;
    padding:28px;
    border-radius:22px;
    background:rgba(255,255,255,.12);
    backdrop-filter:blur(18px);
    box-shadow:0 25px 50px rgba(0,0,0,.5);
    text-align:center;
}
#qrcode{
    background:#fff;
    padding:14px;
    border-radius:18px;
    margin:15px auto;
}
input,button{
    width:100%;
    padding:12px;
    border-radius:12px;
    border:none;
    margin-top:10px;
    font-size:15px;
}
button{
    background:linear-gradient(135deg,#00f260,#0575e6);
    color:#fff;
    cursor:pointer;
}
.admin-dot{
    position:fixed;
    bottom:15px;
    right:15px;
    width:14px;
    height:14px;
    background:#00f260;
    border-radius:50%;
    cursor:pointer;
}
.hidden{display:none}
.admin-box{
    position:fixed;
    bottom:40px;
    right:15px;
    background:#111;
    padding:15px;
    border-radius:12px;
    width:260px;
}
</style>
</head>

<body>

<div class="card">
    <h3>Scan & Pay</h3>

    <div id="qrcode"></div>

    <input type="number" id="amount" placeholder="Enter amount (optional)">
    <button onclick="pay()">Pay Now</button>
</div>

<!-- ADMIN DOT -->
<div class="admin-dot" onclick="toggleAdmin()"></div>

<!-- ADMIN PANEL -->
<div class="admin-box hidden" id="adminBox">
    <input type="password" id="adminPass" placeholder="Admin Password">
    <button onclick="adminLogin()">Login</button>

    <div id="adminPanel" class="hidden">
        <input type="text" id="adminUpi" placeholder="Update UPI ID">
        <input type="number" id="adminAmt" placeholder="Default Amount">
        <button onclick="saveAdmin()">Save</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
/* ================= CONFIG ================= */
let UPI_ID = "shop.mitra@ybl";
let DEFAULT_AMOUNT = "";

const ADMIN_HASH = "9e6a9d6c9c6f7e4a0c7f77a8a7f8d6a8b6f1d7b1a7f2a4f8b9c1e3d0b7a2f1c";

let attempts = 0;
let lockedUntil = 0;

/* ================= QR ================= */
const qrBox = document.getElementById("qrcode");

function makeQR(amount=""){
    qrBox.innerHTML = "";
    let link = `upi://pay?pa=${UPI_ID}&pn=Payment&cu=INR`;
    if(amount) link += `&am=${amount}`;
    new QRCode(qrBox,{text:link,width:180,height:180});
}
makeQR();

function pay(){
    const amt = document.getElementById("amount").value || DEFAULT_AMOUNT;
    let link = `upi://pay?pa=${UPI_ID}&pn=Payment&cu=INR`;
    if(amt) link += `&am=${amt}`;
    window.location.href = link;
}

/* ================= ADMIN OPEN (LONG PRESS) ================= */
let pressTimer;
const adminDot = document.querySelector(".admin-dot");

adminDot.addEventListener("touchstart", startPress);
adminDot.addEventListener("mousedown", startPress);
adminDot.addEventListener("touchend", cancelPress);
adminDot.addEventListener("mouseup", cancelPress);

function startPress(){
    pressTimer = setTimeout(()=>{
        document.getElementById("adminBox").classList.remove("hidden");
    },3000); // 3 sec long press
}
function cancelPress(){
    clearTimeout(pressTimer);
}

/* ================= HASH ================= */
async function sha256(msg){
    const buf = new TextEncoder().encode(msg);
    const hash = await crypto.subtle.digest("SHA-256", buf);
    return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

/* ================= ADMIN LOGIN ================= */
async function adminLogin(){
    const now = Date.now();
    if(now < lockedUntil){
        alert("Admin locked. Try later.");
        return;
    }

    const input = document.getElementById("adminPass").value;
    const hash = await sha256(input);

    if(hash === ADMIN_HASH){
        attempts = 0;
        document.getElementById("adminPanel").classList.remove("hidden");
    }else{
        attempts++;
        alert("Wrong password");

        if(attempts >= 3){
            lockedUntil = now + (5 * 60 * 1000); // 5 min lock
            alert("Too many attempts. Locked for 5 minutes.");
        }
    }
}

/* ================= ADMIN SAVE ================= */
function saveAdmin(){
    const u = document.getElementById("adminUpi").value.trim();
    const a = document.getElementById("adminAmt").value;

    if(u && !u.includes("@")){
        alert("Invalid UPI");
        return;
    }

    if(u) UPI_ID = u;
    DEFAULT_AMOUNT = a;

    makeQR(DEFAULT_AMOUNT);
    alert("Updated securely");
}
</script>

</body>
</html>